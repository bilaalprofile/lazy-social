from django.http import JsonResponse
from django.contrib.auth.decorators import login_required
from django.shortcuts import get_object_or_404
from .models import Post, Like

@login_required
def post_like(request):
    post_id = request.GET.get('id')
    post = get_object_or_404(Post, id=post_id)
    user = request.user

    # Check if the user has already liked the post
    liked = False
    like = Like.objects.filter(user=user, post=post).first()

    if like:
        like.delete()
        message = "You unliked this post."
    else:
        Like.objects.create(user=user, post=post)
        liked = True
        message = "You liked this post."

    response_data = {
        "liked": liked,
        "total_likes": post.likes.count(),
        "message": message,
    }

    return JsonResponse(response_data)